<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SproutHackathon - Vue Frontend</title>
  <script src="https://unpkg.com/vue@3"></script>
</head>
<body>
  <div id="app">
    <h1>Employee Lookup</h1>
    <label>Employee ID:</label>
    <input v-model="employeeId" placeholder="e.g. 123" />
    <button @click="fetchEmployee">Get Employee</button>

    <div v-if="loading">Loading...</div>
    <div v-if="error" style="color:red;">{{ error }}</div>
    <div v-if="employee">
      <h2>Employee Info</h2>
      <p><strong>ID:</strong> {{ employee.id }}</p>
      <p><strong>Name:</strong> {{ employee.fullName }}</p>
    </div>

    <hr />

    <h2>üìù Notes</h2>
    <form @submit.prevent="addNote" style="margin-bottom: 1rem;">
      <input type="text" v-model="newNote.title" placeholder="Title" required />
      <br><br>
      <textarea v-model="newNote.content" placeholder="Content" required></textarea>
      <br><br>
      <button type="submit">Add Note</button>
    </form>

    <div v-if="notesLoading">Loading notes...</div>
    <div v-else-if="notes.length === 0">No notes yet.</div>
    <ul>
      <li v-for="note in notes" :key="note.id">
        <strong>{{ note.title }}</strong> ‚Äî {{ note.content }}
      </li>
    </ul>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          employeeId: '',
          employee: null,
          loading: false,
          error: '',
          notes: [],
          newNote: {
            title: '',
            content: ''
          },
          notesLoading: true
        };
      },
      methods: {
        async fetchEmployee() {
          this.loading = true;
          this.employee = null;
          this.error = '';
          try {
            const response = await fetch(`/api/Employees/${this.employeeId}`);
            if (!response.ok) throw new Error("Not found or server error");
            const data = await response.json();
            this.employee = data;
          } catch (err) {
            this.error = 'Failed to fetch employee.';
          } finally {
            this.loading = false;
          }
        },
        async fetchNotes() {
          try {
            const res = await fetch('/api/notes');
            if (!res.ok) throw new Error('Failed to load notes');
            this.notes = await res.json();
          } catch (err) {
            console.error(err);
          } finally {
            this.notesLoading = false;
          }
        },
        async addNote() {
          try {
            const res = await fetch('/api/notes', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(this.newNote)
            });

            if (!res.ok) throw new Error('Failed to add note');
            const savedNote = await res.json();
            this.notes.push(savedNote);
            this.newNote.title = '';
            this.newNote.content = '';
          } catch (err) {
            alert(err.message);
          }
        }
      },
      mounted() {
        this.fetchNotes();
      }
    }).mount('#app');
  </script>
</body>
</html>
